'use strict';

const getConnection = require('../lib/get-connection');

module.exports = (opts, queues) => {
  // If queues is undefined a autogenerated queue will be created, no need to check its existence
  if (!queues) {
    return Promise.resolve();
  }
  return getConnection(opts)
    .then(([conn, ch]) => {
      ch.on('error', () => {});

      return Promise.all(queues.map(queueName => ch.get(queueName)))
        .then(() => {
          conn.close();
        })
        .catch(err => {
          conn.close();

          return Promise.reject(err);
        });
    });
};
